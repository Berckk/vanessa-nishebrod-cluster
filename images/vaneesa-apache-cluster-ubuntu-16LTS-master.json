{
  "builders": [
      {
         "type": "digitalocean",
         "api_token": "{{user `do_api_token`}}",
         "image": "ubuntu-16-04-x64",
         "region": "fra1",
         "size": "512mb"
      }
  ],

  "provisioners": [{
    "type": "shell",
    "inline": [
      "sleep 30",
      "sudo curl -sSL https://get.docker.com/ | sh;",
      "sudo apt-get install zfs-fuse -y -q ",
      "docker version",
      "curl -L 'https://github.com/docker/compose/releases/download/1.9.0/docker-compose-$(uname -s)-$(uname -m)' -o /usr/local/bin/docker-compose",
      "chmod +x /usr/local/bin/docker-compose",
      "docker-compose --version"
    ]

  },{
    "type": "file",
    "source": "../vanessa-web-services/Dockerfile",
    "destination": "/tmp/apache/Dockerfile"
  },
  {
    "type": "file",
    "source": "../vanessa-web-services/conf/*",
    "destination": "/tmp/apache/dist/"
  },
  {
    "type": "shell",
    "inline": [
        "cd /tmp/apache",
        "docker build -t silverbulleters/vanessa-apache"
    ]
  }],
  "post-processors": [{
      "type": "atlas",
      "token": "{{user `atlas_token`}}",
      "artifact": "silverbulleters/vaneesa-apache-cluster-ubuntu-16LTS-master-digital-ocean",
      "artifact_type": "digitalocean.image",
      "metadata": {
         "created_at": "{{timestamp}}"
      }
    }
  ],

  "variables": {
      "do_api_token": "",
      "atlas_token": "",
      "compression_level": "6"
  }
}